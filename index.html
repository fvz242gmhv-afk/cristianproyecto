<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>F1Ya · Apple Style</title>
<style>
  :root {
    --bg:#0a0a0a;
    --panel:#111111;
    --panel-soft:#161616;
    --text:#f5f5f7;
    --muted:#9b9b9f;
    --accent:#ff2d2d;
    --border:#1f1f1f;
    --radius:18px;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;background:linear-gradient(180deg,#000 0%,var(--bg) 100%);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,system-ui,sans-serif;}
  header{position:sticky;top:0;z-index:50;background:rgba(10,10,10,.7);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);}
  .header-inner{max-width:1600px;margin:0 auto;padding:14px 20px;display:flex;align-items:center;gap:20px;}
  .logo{font-size:20px;font-weight:600}.logo span{color:var(--accent)}
  .tabs{margin-left:auto;display:flex;gap:10px}
  .tab{padding:8px 18px;border-radius:999px;border:1px solid var(--border);background:transparent;color:var(--muted);cursor:pointer;}
  .tab.active{background:var(--accent);color:#fff;border-color:transparent}
  main{max-width:1600px;margin:0 auto;padding:28px 20px 40px;display:grid;grid-template-columns:1fr 400px;gap:28px;}
  .player-card,.chat-card{background:var(--panel);border-radius:var(--radius);overflow:hidden;box-shadow:0 30px 80px rgba(0,0,0,.5);}
  .player-top,.chat-top{padding:14px 18px;border-bottom:1px solid var(--border);font-size:14px;}
  .player-wrap{aspect-ratio:16/9;background:#000}iframe{width:100%;height:100%;border:0}
  .chat-card{display:flex;flex-direction:column}
  .chat-messages{flex:1;padding:12px;overflow-y:auto;font-size:13px;overflow-wrap:anywhere;max-height:500px;}
  .msg{margin-bottom:8px;padding:4px;border-radius:8px;}
  .chat-input{display:flex;gap:8px;padding:10px;border-top:1px solid var(--border);align-items:center;}
  .chat-input input{background:var(--panel-soft);border:1px solid var(--border);border-radius:999px;padding:8px 12px;color:var(--text);font-size:13px;outline:none;flex:1;}
  #nick{width:90px;opacity:.7;cursor:not-allowed}
  .chat-input button{padding:8px 14px;border-radius:999px;border:none;background:var(--accent);color:#fff;cursor:pointer;}
  .auth-buttons{display:flex;gap:8px;padding:10px;border-top:1px solid var(--border);}
  .auth-buttons button{flex:1;background:transparent;border:1px solid var(--border);color:var(--muted);border-radius:999px;padding:6px;cursor:pointer;}
  @media(max-width:1100px){main{grid-template-columns:1fr}}
  .modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:100;}
  .modal-content{background:var(--panel);padding:20px;border-radius:var(--radius);width:300px;display:flex;flex-direction:column;gap:12px;}
  .modal-content input{padding:8px;border-radius:8px;border:1px solid var(--border);background:var(--panel-soft);color:var(--text);outline:none;}
  .modal-content button{padding:8px;border:none;border-radius:999px;background:var(--accent);color:#fff;cursor:pointer;}
  #colorModal,#bgModal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:101;}
  #colorModalContent,#bgModalContent{background:var(--panel);padding:20px;border-radius:var(--radius);display:flex;flex-direction:column;gap:12px;}
  .color-input,.bg-input{width:100%;height:40px;border:none;border-radius:8px;cursor:pointer;}
  .preview-box{padding:6px;border-radius:6px;text-align:center;font-weight:bold;margin-top:6px;}
</style>
</head>
<body>

<header>
  <div class="header-inner">
    <div class="logo">F1<span>Ya</span></div>
    <div class="tabs">
      <button class="tab active" id="btn-daddy" onclick="cambiarStream('daddy')">DAZN F1</button>
      <button class="tab" id="btn-espn" onclick="cambiarStream('espn')">ESPN</button>
      <button class="tab" id="btn-fox" onclick="cambiarStream('fox')">FOX</button>
    </div>
  </div>
</header>

<main>
  <section class="player-card">
    <div class="player-top"><strong>Fórmula 1 · Live</strong></div>
    <div class="player-wrap">
      <iframe id="player" src="about:blank" allowfullscreen></iframe>
    </div>
  </section>

  <aside class="chat-card">
    <div class="chat-top"><strong>Chat en vivo</strong></div>
    <div class="chat-messages" id="messages"></div>

    <div class="chat-input">
      <input id="nick" disabled>
      <input id="text" placeholder="Mensaje…">
      <button onclick="sendMsg()">Enviar</button>
    </div>

    <div class="auth-buttons">
      <button id="btnRegister" onclick="openModal('register')">Registrarse</button>
      <button id="btnLogin" onclick="openModal('login')">Login</button>
      <button id="btnLogout" onclick="logout()" style="display:none">Logout</button>
      <button id="btnColorNick" onclick="openColorModal()" style="display:none">Color Nick</button>
      <button id="btnBgMsg" onclick="openBgModal()" style="display:none">Fondo Mensaje</button>
    </div>
  </aside>
</main>

<!-- MODAL LOGIN/REGISTER -->
<div class="modal" id="loginModal">
  <div class="modal-content">
    <h3 id="modalTitle">Login</h3>
    <input type="text" id="modalNick" placeholder="Nick">
    <input type="password" id="modalPass" placeholder="Contraseña">
    <button id="modalSubmit">Enviar</button>
    <button onclick="closeModal()">Cerrar</button>
  </div>
</div>

<!-- MODAL COLOR NICK -->
<div id="colorModal">
  <div id="colorModalContent">
    <h3>Selecciona un color para tu nick</h3>
    <input type="color" id="colorPicker" class="color-input" value="#ffffff" onchange="updatePreview()">
    <div class="preview-box" id="nickPreview">Preview Nick</div>
    <button onclick="saveNickColor()">Guardar</button>
    <button onclick="closeColorModal()">Cerrar</button>
  </div>
</div>

<!-- MODAL FONDO MENSAJE -->
<div id="bgModal">
  <div id="bgModalContent">
    <h3>Selecciona un fondo para tus mensajes</h3>
    <input type="color" id="bgPicker" class="bg-input" value="#ffffff" onchange="updateBgPreview()">
    <div class="preview-box" id="bgPreview">Preview Mensaje</div>
    <button onclick="saveBgColor()">Guardar</button>
    <button onclick="closeBgModal()">Cerrar</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onChildAdded, set, get, query, limitToLast } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

/* STREAMS */
const streams={daddy:"aHR0cHM6Ly9kYWRkeWhkLmNvbS93YXRjaC9zdHJlYW0tNTM3LnBocA==",
espn:"aHR0cHM6Ly9kYWRkeWhkLmNvbS9zdHJlYW0vc3RyZWFtLTE0OS5waHA=",
fox:"aHR0cHM6Ly9kYWRkeWhkLmNvbS9zdHJlYW0vc3RyZWFtLTc4Ny5waHA="};
const player=document.getElementById('player');
window.cambiarStream=t=>{player.src=atob(streams[t]);['daddy','espn','fox'].forEach(k=>{document.getElementById('btn-'+k).classList.toggle('active',k===t);});};
cambiarStream('daddy');

/* FIREBASE */
const firebaseConfig={apiKey:"AIzaSyDSxZILNH92QqkfnQeSpYZeboqylAo_6S0",
authDomain:"sushitime-b84fc.firebaseapp.com",
databaseURL:"https://sushitime-b84fc-default-rtdb.firebaseio.com",
projectId:"sushitime-b84fc"};
const app=initializeApp(firebaseConfig);
const db=getDatabase(app);
const auth=getAuth(app);

/* CHAT */
const messagesRef=ref(db,'chat/messages');
const box=document.getElementById('messages');
const nickInput=document.getElementById('nick');
const textInput=document.getElementById('text');
let guestNick='Guest'+Math.random().toString(36).substring(2,6).toUpperCase();
let currentNick=guestNick;
let currentColor='#ffffff';
let currentBg='transparent';
let isLoggedIn=false;
nickInput.value=guestNick;

/* AUTH CHANGE */
onAuthStateChanged(auth, async user=>{
  const btnLogin=document.getElementById('btnLogin');
  const btnRegister=document.getElementById('btnRegister');
  const btnLogout=document.getElementById('btnLogout');
  const btnColorNick=document.getElementById('btnColorNick');
  const btnBgMsg=document.getElementById('btnBgMsg');
  if(user){
    const snap=await get(ref(db,'users/'+user.uid));
    currentNick=snap.val().nick||guestNick;
    currentColor=snap.val().color||'#ffffff';
    currentBg=snap.val().bg||'transparent';
    nickInput.value=currentNick;
    nickInput.style.color=currentColor;
    isLoggedIn=true;
    btnLogin.style.display='none';
    btnRegister.style.display='none';
    btnLogout.style.display='inline-block';
    btnColorNick.style.display='inline-block';
    btnBgMsg.style.display='inline-block';
  }else{
    currentNick=guestNick;
    currentColor='#ffffff';
    currentBg='transparent';
    nickInput.value=currentNick;
    nickInput.style.color=currentColor;
    isLoggedIn=false;
    btnLogin.style.display='inline-block';
    btnRegister.style.display='inline-block';
    btnLogout.style.display='none';
    btnColorNick.style.display='none';
    btnBgMsg.style.display='none';
  }
});

/* Últimos 40 mensajes */
const messagesQuery=query(messagesRef, limitToLast(40));
onChildAdded(messagesQuery,snap=>{
  const m=snap.val();
  const div=document.createElement('div');
  div.className='msg';
  div.style.background=m.bg||'transparent';
  const verified=m.uid?' ✅ ':'';
  div.innerHTML=`<strong style="color:${m.color||'#ffffff'}">${verified}${m.nick}</strong>: ${m.text}`;
  box.appendChild(div);
  box.scrollTop=box.scrollHeight;
});

/* SEND MSG */
window.sendMsg=()=>{
  if(!textInput.value.trim())return;
  push(messagesRef,{nick:currentNick,text:textInput.value,time:Date.now(),color:currentColor,bg:currentBg,uid:isLoggedIn?auth.currentUser.uid:null});
  textInput.value='';
};
textInput.addEventListener('keydown',e=>{if(e.key==='Enter')sendMsg();});

/* MODALS */
window.openModal=(type)=>{
  document.getElementById('loginModal').style.display='flex';
  document.getElementById('modalTitle').innerText=type==='login'?'Login':'Registrarse';
  document.getElementById('modalSubmit').onclick=type==='login'?login:register;
}
window.closeModal=()=>{document.getElementById('loginModal').style.display='none';}
window.openColorModal=()=>{document.getElementById('colorModal').style.display='flex';updatePreview();}
window.closeColorModal=()=>{document.getElementById('colorModal').style.display='none';}
window.openBgModal=()=>{document.getElementById('bgModal').style.display='flex';updateBgPreview();}
window.closeBgModal=()=>{document.getElementById('bgModal').style.display='none';}

/* REGISTER/LOGIN/LOGOUT */
async function register(){
  const nick=document.getElementById('modalNick').value;
  const pass=document.getElementById('modalPass').value;
  if(!nick||!pass)return alert('Completa todos los campos');
  const email=`${nick}@chat.f1ya.com`;
  const {user}=await createUserWithEmailAndPassword(auth,email,pass);
  await set(ref(db,'users/'+user.uid),{nick,color:'#ffffff',bg:'transparent'});
  closeModal();
}
async function login(){
  const nick=document.getElementById('modalNick').value;
  const pass=document.getElementById('modalPass').value;
  if(!nick||!pass)return alert('Completa todos los campos');
  const email=`${nick}@chat.f1ya.com`;
  await signInWithEmailAndPassword(auth,email,pass);
  closeModal();
}
window.logout=()=>signOut(auth);

/* COLOR NICK */
window.updatePreview=()=>{
  const val=document.getElementById('colorPicker').value;
  document.getElementById('nickPreview').style.color=val;
  document.getElementById('nickPreview').innerText=currentNick;
}
window.saveNickColor=()=>{
  const color=document.getElementById('colorPicker').value;
  currentColor=color;
  nickInput.style.color=color;
  if(auth.currentUser) set(ref(db,'users/'+auth.currentUser.uid+'/color'),color);
  closeColorModal();
}

/* FONDO MENSAJE */
window.updateBgPreview=()=>{
  const val=document.getElementById('bgPicker').value;
  document.getElementById('bgPreview').style.backgroundColor=val;
  document.getElementById('bgPreview').innerText='Preview Mensaje';
}
window.saveBgColor=()=>{
  const bg=document.getElementById('bgPicker').value+'33'; // transparente
  currentBg=bg;
  if(auth.currentUser) set(ref(db,'users/'+auth.currentUser.uid+'/bg'),bg);
  closeBgModal();
}
</script>

</body>
</html>
